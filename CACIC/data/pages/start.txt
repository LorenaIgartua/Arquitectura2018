
====== ARQUITECTURAS WEB - TUDAI 2018 ======
====== TRABAJO PRACTICO ESPECIAL ======

===== Introduccion =====

Conforme lo requerido, debiamos desarrollar un sistema que ayude a asignar evaluadores a los trabajos enviados a un congreso. Estas asignaciones tenian limitaciones, tales como que el evaluador designado debia haber declarado
conocimiento en todos los temas del trabajo, especificados en sus palabras claves. Para el caso de los posters, bastaba que el evaluador tenga conocimiento en uno de los temas del poster, o sea, en una de las palabras clave. A su vez, se debe controlar que el evaluador designado no coincida con alguno de los autores del trabajo, o alguno de sus compañeros de trabajo.
Se debia definir e implementar las clases que modelen el sistema y su persistencia. Con eso en funcionamiento, debiamos exponer los servicios implementados mediante una interfaz REST.

===== Desarrollo =====

==== Tecnologias y Patrones usados====

Como punto de partida, definimos las entidades que ibamos a necesitar, y sus atributos. Determinadas las entidades, se aplico el esquema ORM para su persistencia, utilizando como proveedor JPA a Hivernete. La Base de Datos que utilizamos es MySQL.  A su vez, y considerando el uso del patron de diseño DAO para aislar la aplicación de la tecnología de persistencia Java subyacente  (Hivernete).
El esquema  de la aplicacion es este:

{{ :arquit1.png?600 |}}

A este esquema, y conforme se requirio para la segunda etapa del proyecto, debiamos  agregar nuevas tecnologias, para convertir la aplicacion a un servicio web, indicando a Apache Tomcat como nuestro ServletContainer, y agregamos  una interfaz REST que satisfaga los servicios implementados, usando Jersey. 
El esquema  de la aplicacion es este:


{{ :arquit2.png?600 |}}

Esto implico desarrollar mas clases y mas servicios, denominados RESTController, uno para cada entidad definida.


==== Aplicacion ====
Con todo esto, el diagrama de Entidad-Relacion obtenido es el siguiente:


{{ :congreso-2018-11-15_17_20.png |}}

Y el diagrama de clases , el siguiente:







Como se observa del diagrama, se implementaron  5 entidades:

  * Empresa, para referirse al lugar de trabajo del futuro autor/evaluador. Esta entidad se definio como tal, porque una de las condiciones de asignacion de evaluaciones, era que el denominado evaluador no trabajara junto con alguno de los autores del trabajo.

  * Tema, para referirse a las palabras claves o topicos de cada trabajo presentado en el congreso, y, tambien,  a los conocimientos que se adjudica cada usuario del sistema. Estos temas pueden ser generales o especificos.

  * Usuario, para referirse a las personas que participan del congreso, ya sea en su rol de autor de un trabajo, o de evaluador de alguno de los trabajos presentados. Esta entidad tiene relacion de tipo ManyToMany tanto con la entidad Tema como con la entidad Trabajo, generando esto las tablas usuario-tema y trabajo-usuario en nuestra Base de Datos (en la relacion con trabajo, el dueño es la entidad Trabajo, y Usuario la mapea con el atributo autores).

  * Trabajo, para referirse a los articulos, posters o resumenes presentados en el congreso.  Esta entidad tiene relacion de tipo ManyToMany tanto con la entidad Tema como con la entidad Trabajo, generando esto las tablas trabajo-tema y trabajo-usuario en nuestra Base de Datos.

  *  Evaluacion, para indicar el nuevo objeto que se genera al designar a un usuario como evaluador de un trabajo. Para que esto ocurra, el usuario debe cumplir determinadas condiciones, a saber: 
             - que no trabaje en la misma empresa que alguno de los autores del trabajo.
             - que conozca uno de los temas a que se refiere el trabajo a asignar, en cado que un trabajo de tipo  Poster.
             -  que conozca todos los temas a que se refiere el trabajo a asignar, en cado que un trabajo de tipo  No Poster.
             - que no tenga mas de  3 evaluaciones asignadas.
A su vez, cada trabajo puede tener, como maximo, 3 evaluadores designados.

Definidas las entidades, con sus tags para mapear a la Base de Datos, y sus metodos get y set, se procedio a implementar los servicios que permitan persistir, leer (todos, o uno en particular), borrar y actualizar los objetos.
Para esto, se utilizo la interfaz DAO, que definia esos metodos, y se creo un Servicio para cada entidad previamente definida. A los metodos de la interfaz, se agregaron otros que requeria la aplicacion, en orden de satisfacer servicios puntuales.

Por ultimo, se implementaron los RESTControllers, definiendo las URL  de nuestra aplicacion, y los metodos a invocar por cada 
 metodo HTTP. Se definieron los metodos basicos (create, getAll, getById, delete y update), y otros definidos para satisfacer servicios puntuales.

La URL base es la siguiente:

[[http://localhost:8080/CONGRESO/api]]

desde alli,  podemos consultar a cada entidad, con su Path. Para la entidad Tema, el path es **temas**, para Empresa, **empresas**, para Usuario, **usuarios**, para Trabajo, **trabajos** y para Evaluacion, **evaluaciones**.
Desde esa URL, segun el metodo HTTP que usemos, sera la informacion que obtendremos.

Tambien se implemento la posibilidad de, ingresado un id particular de un trabajo, por ejemplo, podemos averiguar sus autores, sus palabrasClaves, las evaluaciones asignadas y una lista de evaluadores en condiciones de evaluar ese trabajo. Las URL, si consultamos particularmente por el id 33, serian:

[[http://localhost:8080/CONGRESO/api/trabajos/33/autores]]

[[http://localhost:8080/CONGRESO/api/trabajos/33/temas]]

[[http://localhost:8080/CONGRESO/api/trabajos/33/evaluaciones]]

[[http://localhost:8080/CONGRESO/api/trabajos/33/evaluadoresParaAsignar]]

Mismo recurso para un usuario. Las URL para consultar conocimientos, trabajos propios , evaluaciones asignadas al usuario y lista de trabajos que pueden ser evaluados por un usuario particular, por ejemplo, 23, serian:

[[http://localhost:8080/CONGRESO/api/usuarios/23/temas]]

[[http://localhost:8080/CONGRESO/api/usuarios/23/trabajos]]

[[http://localhost:8080/CONGRESO/api/usuarios/23/evaluaciones]]

[[http://localhost:8080/CONGRESO/api/usuarios/23/trabajosParaAsignar]]

Para asignar la revision de un trabajo a un determinado evaluador, y dadas las restricciones que se indicaron anteriormente, se diseño la asignacion a traves del metodo EvaluacionesDAO.getInstance().asignarEvaluador(trabajo). En este metodo, se consulta que usuario esta en condicion de evaluar ese trabajo en particular, e identificado el mismo, se crea y persiste la asignacion.
Para realizarlo a traves de la API, y asignar un evaluador por ejemplo al trabajo  con id 33, la URL seria:

[[http://localhost:8080/CONGRESO/api/evaluaciones/asignarEvaluador/33]]



Como se observa del diagrama de clases, se distinguen 3 capas en la aplicacion, la primera, de DAOs, que permiten persistir  nuestras entidades POJO en la Base de Datos,  la segunda de RESTControllers, que reciben los request del cliente, interpreta la ruta y conecta con aplicacion (y esta a la Base de Datos), y la tercera etapa es donde se generan los request, y en este caso, realizazo a trabes de test de JUnit. En un diagrama de componentes, esto se veria de esta manera:



==== Microservicio ====

Se solicita implementar en Java con SpringBoot un microservicio que permita retornar todas los trabajos enviados por un autor determinado.
Para esto, se creo el proyecto en SprinBoot. Cuando este estuvo  en funcionamiento, y conectado al Tomcat, se procedio a incorporar las clases para satisfacer al servicio solicitado.
Se agregaron las entidades, se genero el repositorio que conecta con la Base de Datos, se implemento el servicio para usar ese repositorio, y, finalmente, el controler REST, que determinaba la URL para invocar el servicio.
De esta manera, si queremos conocer los trabajos enviador por el usurio con id 23, la URL es la siguiente:

[[http://localhost:8080/usuarios/23/trabajos]]


